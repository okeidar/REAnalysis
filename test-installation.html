<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Real Estate Analyzer Extension</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .test-item {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 4px;
            border-left: 4px solid #007bff;
        }
        .success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        .error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        .warning {
            border-left-color: #ffc107;
            background: #fff3cd;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .code {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>üè† Real Estate Analyzer Extension - Installation Test</h1>
    
    <div class="test-section">
        <h2>üìã Pre-Installation Checklist</h2>
        <div class="test-item">
            <strong>‚úÖ Chrome Version:</strong> <span id="chromeVersion">Checking...</span>
        </div>
        <div class="test-item">
            <strong>‚úÖ Developer Mode:</strong> 
            <span>Go to <code>chrome://extensions/</code> and enable "Developer mode"</span>
        </div>
        <div class="test-item">
            <strong>‚úÖ Files Ready:</strong> 
            <span>Ensure all extension files are in the project directory</span>
        </div>
    </div>

    <div class="test-section">
        <h2>üîß Installation Steps</h2>
        <ol>
            <li><strong>Open Extensions Page:</strong> Navigate to <code>chrome://extensions/</code></li>
            <li><strong>Enable Developer Mode:</strong> Toggle the switch in the top-right corner</li>
            <li><strong>Load Extension:</strong> Click "Load unpacked" and select the project directory</li>
            <li><strong>Verify Installation:</strong> Look for the "üìä RE" icon in your toolbar</li>
        </ol>
        
        <button onclick="openExtensionsPage()">Open Extensions Page</button>
    </div>

    <div class="test-section">
        <h2>üß™ Quick Tests</h2>
        
        <div class="test-item">
            <h3>Test 1: Extension Detection</h3>
            <p>Check if the extension is properly loaded:</p>
            <button onclick="testExtensionLoaded()">Test Extension Loaded</button>
            <div id="extensionTest" class="result"></div>
        </div>

        <div class="test-item">
            <h3>Test 2: Popup Interface</h3>
            <p>Click the extension icon in your toolbar to test the popup interface.</p>
            <div class="warning">
                <strong>Expected:</strong> Popup should open showing "Real Estate Analyzer" interface
            </div>
        </div>

        <div class="test-item">
            <h3>Test 3: Property Page Detection</h3>
            <p>Visit a property listing to test content script injection:</p>
            <button onclick="openTestProperty()">Open Test Property</button>
            <div class="warning">
                <strong>Expected:</strong> "üìä Analyze Property" button should appear on property pages
            </div>
        </div>

        <div class="test-item">
            <h3>Test 4: Storage System</h3>
            <p>Test the extension's storage functionality:</p>
            <button onclick="testStorage()">Test Storage</button>
            <div id="storageTest" class="result"></div>
        </div>
    </div>

    <div class="test-section">
        <h2>üêõ Troubleshooting</h2>
        
        <div class="test-item">
            <h3>Common Issues:</h3>
            <ul>
                <li><strong>Service Worker Error:</strong> Check browser console for detailed error messages</li>
                <li><strong>Extension Not Loading:</strong> Verify all files are present and manifest.json is valid</li>
                <li><strong>Icons Not Showing:</strong> Clear browser cache and reload extension</li>
                <li><strong>Button Not Appearing:</strong> Ensure you're on a property detail page, not search results</li>
            </ul>
        </div>

        <div class="test-item">
            <h3>Debug Steps:</h3>
            <div class="code">
                1. Open Chrome DevTools (F12)<br>
                2. Check Console tab for errors<br>
                3. Go to chrome://extensions/<br>
                4. Click "Inspect views ‚Üí background page"<br>
                5. Look for error messages
            </div>
        </div>

        <button onclick="openTroubleshooting()">View Full Troubleshooting Guide</button>
        <button onclick="runDebugScript()">Run Debug Script</button>
    </div>

    <div class="test-section">
        <h2>‚úÖ Success Indicators</h2>
        <div class="test-item success">
            <h3>Extension Working Correctly If:</h3>
            <ul>
                <li>‚úÖ Extension icon appears in Chrome toolbar</li>
                <li>‚úÖ Popup opens when clicking the icon</li>
                <li>‚úÖ "Analyze Property" button appears on property pages</li>
                <li>‚úÖ Property analysis modal displays results</li>
                <li>‚úÖ Settings page loads without errors</li>
                <li>‚úÖ No console errors in background script</li>
            </ul>
        </div>
    </div>

    <script>
        // Detect Chrome version
        function getChromeVersion() {
            const userAgent = navigator.userAgent;
            const match = userAgent.match(/Chrome\/(\d+)/);
            return match ? parseInt(match[1]) : null;
        }

        // Update Chrome version display
        function updateChromeVersion() {
            const version = getChromeVersion();
            const element = document.getElementById('chromeVersion');
            
            if (version) {
                if (version >= 88) {
                    element.innerHTML = `<span style="color: green;">Chrome ${version} ‚úÖ (Compatible)</span>`;
                } else {
                    element.innerHTML = `<span style="color: red;">Chrome ${version} ‚ùå (Need 88+)</span>`;
                }
            } else {
                element.innerHTML = '<span style="color: orange;">Unknown browser ‚ö†Ô∏è</span>';
            }
        }

        // Test if extension is loaded
        function testExtensionLoaded() {
            const result = document.getElementById('extensionTest');
            
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                try {
                    // Try to get extension info
                    const manifest = chrome.runtime.getManifest();
                    if (manifest && manifest.name === "ChatGPT Real Estate Analyzer") {
                        result.innerHTML = '<div class="success">‚úÖ Extension detected and loaded successfully!</div>';
                    } else {
                        result.innerHTML = '<div class="warning">‚ö†Ô∏è Chrome extension API available but Real Estate Analyzer not detected</div>';
                    }
                } catch (error) {
                    result.innerHTML = '<div class="error">‚ùå Error accessing extension: ' + error.message + '</div>';
                }
            } else {
                result.innerHTML = '<div class="error">‚ùå Chrome extension API not available. Make sure you\'re testing in Chrome with the extension loaded.</div>';
            }
        }

        // Test storage functionality
        function testStorage() {
            const result = document.getElementById('storageTest');
            
            if (typeof chrome !== 'undefined' && chrome.storage) {
                // Test basic storage
                const testData = { testKey: 'testValue', timestamp: Date.now() };
                
                chrome.storage.local.set(testData, function() {
                    if (chrome.runtime.lastError) {
                        result.innerHTML = '<div class="error">‚ùå Storage write failed: ' + chrome.runtime.lastError.message + '</div>';
                    } else {
                        chrome.storage.local.get(['testKey'], function(data) {
                            if (chrome.runtime.lastError) {
                                result.innerHTML = '<div class="error">‚ùå Storage read failed: ' + chrome.runtime.lastError.message + '</div>';
                            } else if (data.testKey === 'testValue') {
                                result.innerHTML = '<div class="success">‚úÖ Storage system working correctly!</div>';
                                // Clean up test data
                                chrome.storage.local.remove(['testKey', 'timestamp']);
                            } else {
                                result.innerHTML = '<div class="error">‚ùå Storage data mismatch</div>';
                            }
                        });
                    }
                });
            } else {
                result.innerHTML = '<div class="error">‚ùå Chrome storage API not available</div>';
            }
        }

        // Open extensions page
        function openExtensionsPage() {
            if (typeof chrome !== 'undefined' && chrome.tabs) {
                chrome.tabs.create({ url: 'chrome://extensions/' });
            } else {
                window.open('chrome://extensions/', '_blank');
            }
        }

        // Open test property page
        function openTestProperty() {
            const testUrls = [
                'https://www.zillow.com/homedetails/',
                'https://www.redfin.com/',
                'https://www.realtor.com/',
                'https://www.trulia.com/'
            ];
            
            alert('Navigate to any property listing on:\\n\\n' + testUrls.join('\\n') + '\\n\\nThen look for the "üìä Analyze Property" button.');
        }

        // Open troubleshooting guide
        function openTroubleshooting() {
            window.open('./TROUBLESHOOTING.md', '_blank');
        }

        // Run debug script
        function runDebugScript() {
            const script = document.createElement('script');
            script.src = './debug-extension.js';
            document.head.appendChild(script);
            
            setTimeout(() => {
                alert('Debug script loaded! Check the browser console (F12) for detailed results.');
            }, 500);
        }

        // Initialize page
        updateChromeVersion();
    </script>
</body>
</html>
